# SmokeSpot 상용화 업그레이드 계획서

## 현재 상태 분석

### 작동하는 기능
- 지도 표시 및 마커 렌더링 (65,912개 스팟)
- 사진 있는 마커 썸네일 프리뷰
- 필터링 (흡연/금연/사용자 구분)
- 즐겨찾기 (로컬 저장)
- 오프라인 캐싱 (Service Worker)

### 문제점
1. **검색 기능**: 이름 필터링만 됨, 위치 검색/이동 안됨
2. **현재 위치**: 웹에서만 작동, 모바일 앱에서 권한 문제
3. **장소 등록**: 로컬에만 저장, 개발자 검토 불가
4. **사진 촬영**: 갤러리만 가능, 카메라 직접 촬영 미구현
5. **보안**: 기본적인 XSS 방지만 있음

---

## 업그레이드 계획

### Phase 1: 핵심 버그 수정 (필수)

#### 1.1 검색 기능 개선
- [ ] Nominatim API 연동 (주소/장소명 검색)
- [ ] 검색 결과 목록 표시
- [ ] 선택 시 해당 위치로 지도 이동
- [ ] 검색어 자동완성

#### 1.2 현재 위치 기능 수정
- [ ] Capacitor Geolocation 플러그인 정상화
- [ ] 권한 요청 UI 개선
- [ ] 위치 불가 시 대체 동작 (IP 기반 대략적 위치)

#### 1.3 카메라 기능 구현
- [ ] Capacitor Camera 플러그인 연동
- [ ] 갤러리 선택 + 카메라 촬영 선택 UI
- [ ] 이미지 압축 (최대 1MB)
- [ ] 사진 필수 체크 (최소 1장)

---

### Phase 2: 백엔드 인프라 (AWS)

#### 2.1 AWS 아키텍처
```
┌─────────────────────────────────────────────────────────┐
│                    AWS Free Tier                        │
├─────────────────────────────────────────────────────────┤
│  S3 Bucket          │  사진 저장 (5GB 무료)            │
│  DynamoDB           │  스팟 데이터, 신청 내역 (25GB)   │
│  Lambda             │  이메일 발송, API 처리 (100만/월)│
│  API Gateway        │  REST API 엔드포인트            │
│  SES                │  이메일 발송 (62,000/월 무료)    │
│  Cognito            │  소셜 로그인 (MAU 50,000 무료)   │
└─────────────────────────────────────────────────────────┘
```

#### 2.2 데이터베이스 스키마 (DynamoDB)
```
SpotRequests 테이블:
- requestId (PK)
- userId
- spotData (name, lat, lng, address, memo, type)
- photos (S3 URLs)
- status (pending/approved/rejected)
- createdAt
- reviewedAt
- reviewerNote

Users 테이블:
- userId (PK)
- provider (google/kakao/naver)
- email
- displayName
- createdAt
- lastLogin
- contributions (등록 수)
```

#### 2.3 API 엔드포인트
- `POST /spots/request` - 새 장소 신청
- `GET /spots/requests` - 신청 목록 (관리자)
- `PUT /spots/requests/{id}` - 승인/거절
- `POST /auth/login` - 소셜 로그인
- `GET /user/profile` - 사용자 정보

---

### Phase 3: 소셜 로그인 구현

#### 3.1 지원 플랫폼
| 플랫폼 | 대상 사용자 | OAuth Provider |
|--------|------------|----------------|
| Google | 전세계 | AWS Cognito |
| Kakao  | 한국   | AWS Cognito Custom |
| Naver  | 한국   | AWS Cognito Custom |
| Apple  | iOS 필수 | AWS Cognito |

#### 3.2 로그인 플로우
1. 사용자가 소셜 로그인 버튼 클릭
2. Cognito로 리다이렉트
3. 소셜 인증 완료
4. JWT 토큰 발급
5. 앱에서 토큰 저장 (Secure Storage)

#### 3.3 로그인 혜택
- 장소 등록 가능
- 등록 내역 확인
- 기여도 배지

---

### Phase 4: 장소 등록 프로세스

#### 4.1 신청 플로우
```
사용자 앱                     AWS                        관리자
    │                          │                           │
    ├──── 장소 정보 입력 ─────>│                           │
    │     (사진 필수)          │                           │
    │                          ├──── 이메일 알림 ─────────>│
    │                          │                           │
    │<─── "검토 중" 상태 ──────│                           │
    │                          │                           │
    │                          │<───── 승인/거절 ──────────│
    │                          │                           │
    │<─── 푸시 알림 ───────────│                           │
```

#### 4.2 이메일 알림 내용
- 신청자 정보 (이름, 이메일)
- 장소 정보 (이름, 좌표, 주소)
- 첨부 사진 미리보기
- 승인/거절 링크 (관리자 페이지)

#### 4.3 관리자 페이지
- 간단한 웹 대시보드
- 신청 목록 확인
- 지도에서 위치 확인
- 원클릭 승인/거절

---

### Phase 5: 보안 강화

#### 5.1 앱 보안
- [ ] HTTPS 전용 통신
- [ ] API 키 환경변수 관리
- [ ] JWT 토큰 검증
- [ ] Rate Limiting (분당 60 요청)
- [ ] 입력값 서버사이드 검증

#### 5.2 데이터 보안
- [ ] 사진 메타데이터 제거 (EXIF 삭제)
- [ ] 개인정보 최소 수집
- [ ] S3 버킷 보안 정책

#### 5.3 Google Play 보안 요구사항
- [ ] Target API Level 34 (Android 14)
- [ ] 데이터 안전 섹션 준수
- [ ] 권한 사용 이유 명시

---

### Phase 6: Google Play 출시 준비

#### 6.1 필수 문서
- [ ] 개인정보처리방침 (Privacy Policy)
- [ ] 이용약관 (Terms of Service)
- [ ] 데이터 안전 양식

#### 6.2 앱 메타데이터
- [ ] 앱 아이콘 (512x512)
- [ ] 기능 그래픽 (1024x500)
- [ ] 스크린샷 (최소 4장)
- [ ] 앱 설명 (한국어/영어/일본어)

#### 6.3 콘텐츠 등급
- 담배 관련 앱이므로 적절한 연령 등급 필요
- PEGI 18+ / ESRB Mature 예상

#### 6.4 권한 목록
| 권한 | 사용 목적 |
|------|----------|
| CAMERA | 장소 사진 촬영 |
| ACCESS_FINE_LOCATION | 현재 위치 확인 |
| INTERNET | 지도 데이터 로드 |
| ACCESS_NETWORK_STATE | 오프라인 모드 감지 |

---

### Phase 7: 광고 통합 (AdMob)

#### 7.1 배너 광고 위치
- 화면 하단 고정 (지도 위, 50dp 높이)
- 팝업/모달에서는 비표시

#### 7.2 AdMob 설정
- 앱 ID 등록
- 배너 광고 단위 생성
- 테스트 모드로 개발

#### 7.3 광고 없는 프리미엄 (선택)
- 월 ₩1,900 구독
- 광고 제거 + 추가 기능

---

### Phase 8: 한국 공공데이터 API 연동

#### 8.1 현재 연동된 API
- ✅ 전국 금연구역 표준데이터
- ✅ 세종시 금연/흡연구역
- ✅ 서울시 구별 흡연구역 (송파, 중구, 광진, 마포)
- ✅ 경기 안양시 흡연구역
- ✅ 부산 연제구 흡연실
- ✅ 인천 서구 흡연구역

#### 8.2 필요한 API 키
사용자께서 data.go.kr에서 API 키를 발급받아야 합니다:
1. https://www.data.go.kr 접속
2. 회원가입 후 로그인
3. 아래 API 활용신청:
   - 전국금연구역표준데이터
   - 세종특별자치시_금연구역정보
   - 각 지자체별 흡연구역 API

#### 8.3 추가 가능한 API
- 강원특별자치도 원주시 실외흡연구역
- 대전광역시 흡연구역
- 대구광역시 금연/흡연구역
- (파일데이터 제공 지역은 별도 처리 필요)

---

## 구현 우선순위

### 1단계 (즉시 - 1주)
1. 검색 기능 수정 (Nominatim 연동)
2. 현재 위치 버그 수정
3. 카메라 촬영 기능
4. 사진 필수 검증

### 2단계 (2주)
5. AWS 인프라 구축
6. 소셜 로그인 (Google 먼저)
7. 장소 신청 API
8. 이메일 알림

### 3단계 (3주)
9. 관리자 대시보드
10. 보안 강화
11. 카카오/네이버 로그인
12. 개인정보처리방침 작성

### 4단계 (4주)
13. AdMob 통합
14. Google Play 출시 준비
15. 앱 심사 제출
16. 공공데이터 API 키 연동

---

## 사용자 액션 필요 항목

### 지금 준비할 것
1. **Google Cloud Console** 계정 설정
   - OAuth 2.0 클라이언트 ID 생성
   - Cloud 프로젝트 생성

2. **AWS 계정** 확인
   - Free Tier 상태 확인
   - DynamoDB, Lambda, SES 권한 확인

3. **Kakao Developers** 등록
   - https://developers.kakao.com
   - 앱 생성 및 Kakao Login 활성화

4. **Naver Developers** 등록
   - https://developers.naver.com
   - 애플리케이션 등록

5. **data.go.kr API 키** 발급
   - 공공데이터 API 활용신청

6. **AdMob 계정** 생성
   - https://admob.google.com
   - 앱 등록

### 비즈니스 이메일 권장사항
- 비즈니스용 Gmail (예: support@smokespot.app) 사용 권장
- Google Workspace 또는 일반 Gmail 무관
- AWS SES에서 발신 이메일로 등록 필요

---

## 비용 예상 (월간)

| 서비스 | Free Tier | 초과 시 |
|--------|-----------|---------|
| AWS S3 | 5GB | ~$0.023/GB |
| DynamoDB | 25GB + 25 WCU/RCU | 사용량 기반 |
| Lambda | 100만 요청 | $0.20/100만 |
| API Gateway | 100만 요청 | $3.50/100만 |
| SES | 62,000/월 | $0.10/1000 |
| Cognito | 50,000 MAU | $0.0055/MAU |

**예상 월 비용**: Free Tier 내 운영 시 $0, 사용량 증가 시 $5~20
